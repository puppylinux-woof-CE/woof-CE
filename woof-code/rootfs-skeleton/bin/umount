#!/bin/sh

#set -x ; exec &> /tmp/umount.log

[ ! $1 ] && exec umount-FULL

if [ -f /usr/local/pup_event/frontend_rox_funcs ] ; then
	. /usr/local/pup_event/frontend_rox_funcs 2>/dev/null
	rox_umount "$@"
	retval=$?
else
	umount-FULL -d "$@"
	retval=$?
fi

for fld in "$(ls -1 /media/* 2>/dev/null | tr '\n' ' ')"
do
 if [ "$(mount | grep "/media/$fld")" == "" ] && [ "$(ls /media/$fld 2>/dev/null)" == "" ]; then
  rmdir /media/$fld
 fi
done

exit $retval
