#!/bin/bash
#this script is started from $HOME/.jwmrc

export TEXTDOMAIN=jwm
export OUTPUT_CHARSET=UTF-8

XBEL_PATH=$HOME/.local/share/recently-used.xbel
if [[ -e $XBEL_PATH ]];then
    MAX_ITEMS=20
    IFS=$'\n'
    ITEMS=$(awk -F'"' '/file:\/\//  { sub("file://","",$2); print $2}' $XBEL_PATH)
    printf -v ITEMS "${ITEMS//%/\\x}"               #convert UTF-8
    ITEMS=$(find $ITEMS   | tail -n $MAX_ITEMS)     #remove non-existent files, cut list off at MAX_ITEMS
    ITEMS=$(echo "$ITEMS" | sed  -r 's_(.*/)(.*)_<Program label="\2" tooltip="\1\2">rox -s "\1\2"</Program>_')
else
    ITEMS="<Program label=\"File ${XBEL_PATH##*/} $(gettext 'not found')!\"></Program>"
fi
echo  "<JWM>
$ITEMS
</JWM>"
